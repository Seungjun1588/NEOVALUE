return(days)
}
newcolnames = colnames(sales19)[-(1:2)] %>% as.numeric %>% sapply(makeyear,month=start,year=year)
colnames(sales19)[3:length(colnames(sales19))] = newcolnames
colnames(sales19)[1] = "SHOP_CD"
for(month in (start+1):12){
# 해당 월 파일 가져오기
sales_month = read_excel(paste0(pwd,Year,"/",file_lst[month]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
# 열이름 변경
newcolnames = colnames(sales_month)[-(1:2)] %>% as.numeric %>% sapply(makeyear,year=year,month=month)
print(newcolnames)
print("*************************")
colnames(sales_month)[3:length(colnames(sales_month))] = newcolnames
colnames(sales_month)[1] = "SHOP_CD"
# 병합
sales19 = merge(sales19,sales_month,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
}
return(sales19)
}
sales19 = MergedDataSet(year=2019,start=4)
View(sales19)
length(unique(sales19$SHOP_NAME))
length(unique(sales19$SHOP_CD))
length(unique(sales19$SHOP_NAME))
sales19 %>%
group_by(SHOP_NAME) %>%
summarise(n=n())
sales19 %>%
group_by(SHOP_NAME) %>%
summarise(n=n()) %>%
arrange(desc(n))
# year = 숫자, start = 시작월(숫자)
MergedDataSet = function(year,start=1,end=12){
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
# 2019년 4월에서12월까지만 병합.
sales19 = read_excel(paste0(pwd,Year,"/",file_lst[start]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
newcolnames = colnames(sales19)[-(1:2)] %>% as.numeric %>% sapply(makeyear,month=start,year=year)
colnames(sales19)[3:length(colnames(sales19))] = newcolnames
colnames(sales19)[1] = "SHOP_CD"
for(month in (start+1):end){
# 해당 월 파일 가져오기
sales_month = read_excel(paste0(pwd,Year,"/",file_lst[month]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
# 열이름 변경
newcolnames = colnames(sales_month)[-(1:2)] %>% as.numeric %>% sapply(makeyear,year=year,month=month)
print(newcolnames)
print("*************************")
colnames(sales_month)[3:length(colnames(sales_month))] = newcolnames
colnames(sales_month)[1] = "SHOP_CD"
# 병합
sales19 = merge(sales19,sales_month,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
}
return(sales19)
}
sales19 = MergedDataSet(year=2019,start=4)
sales20 = MergedDataSet(year=2020,start=1)
sales21 = MergedDataSet(year=2020,start=1)
sales22 = MergedDataSet(year=2020,start=1,end=10)
TotalSalesNum = merge(sales19,sales20,sales21,sales22,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
TotalSalesNum = merge(sales19,sales20,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
?merge
TotalSalesNum = merge(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = merge(sales19,sales20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = merge(TotalSalesNum,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = merge(TotalSalesNum,sales22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSalesNum)
dim(sales19)
TotalSalesNum = full_join(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(sales19,sales20,sales21,sales22,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(sales21,sales22,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(TotalSalesNum,sales22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSalesNum)
length(unique(TotalSalesNum$SHOP_CD))
length(unique(TotalSalesNum$SHOP_NAME))
# 이름은 같으나 코드가 달라진 가게(어떤 변화가 있었는지 확인 필요)
TotalSalesNum %>%
group_by(SHOP_NAME) %>%
summarise(n=n()) %>%
arrange(desc(n))
# 일별 매출건수
sales19 = MergedDataSet(year=2019,start=4)
sales20 = MergedDataSet(year=2020,start=1)
sales21 = MergedDataSet(year=2021,start=1)
sales22 = MergedDataSet(year=2022,start=1,end=10)
TotalSalesNum = full_join(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesNum = full_join(TotalSalesNum,sales22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSalesNum)
length(unique(TotalSalesNum$SHOP_CD))
length(unique(TotalSalesNum$SHOP_NAME))
# 이름은 같으나 코드가 달라진 가게(어떤 변화가 있었는지 확인 필요)
TotalSalesNum %>%
group_by(SHOP_NAME) %>%
summarise(n=n()) %>%
arrange(desc(n))
# install.packages("data.table")
library(data.table)
library(readxl)
library(tidyverse)
library(readxl)
pwd = "C:/Seungjun/neovalue/NEOVALUE/230616_네오밸류 데이터(발송용)/네오밸류 데이터/02_운영데이터 등/230531_광교 데이터/후지쯔 매출내역(Open~2210)/일별"
#---------------------------------------------------------------------#
#---------------------------------------------------------------------#
# 함수 생성
# year = 숫자, start = 시작월(숫자)
MergedDataSet = function(year=2019,start=1,end=12,pwd){
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
# 2019년 4월에서12월까지만 병합.
sales19 = read_excel(paste0(pwd,Year,"/",file_lst[start]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
newcolnames = colnames(sales19)[-(1:2)] %>% as.numeric %>% sapply(makeyear,month=start,year=year)
colnames(sales19)[3:length(colnames(sales19))] = newcolnames
colnames(sales19)[1] = "SHOP_CD"
for(month in (start+1):end){
# 해당 월 파일 가져오기
sales_month = read_excel(paste0(pwd,Year,"/",file_lst[month]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
# 열이름 변경
newcolnames = colnames(sales_month)[-(1:2)] %>% as.numeric %>% sapply(makeyear,year=year,month=month)
print(newcolnames)
print("*************************")
colnames(sales_month)[3:length(colnames(sales_month))] = newcolnames
colnames(sales_month)[1] = "SHOP_CD"
# 병합
sales19 = merge(sales19,sales_month,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
}
return(sales19)
}
dir = paste0(pwd,"/매출건수")
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,pwd=dir)
salescnt21 = MergedDataSet(year=2021,start=1,pwd=dir)
salescnt22 = MergedDataSet(year=2022,start=1,end=10,pwd=dir)
TotalSalesCnt = full_join(salescnt19,salescnt20,salescnt21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt = full_join(TotalSalesCnt,salescnt22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSalesCnt)
salescnt22 = MergedDataSet(year=2022,start=1,end=11,pwd=dir)
dir = paste0(pwd,"/매출건수")
# install.packages("data.table")
library(data.table)
library(readxl)
library(tidyverse)
library(readxl)
#---------------------------------------------------------------------#
# 매출 데이터 통합
#---------------------------------------------------------------------#
# 상위 디렉토리
pwd = "C:/Seungjun/neovalue/NEOVALUE/230616_네오밸류 데이터(발송용)/네오밸류 데이터/02_운영데이터 등/230531_광교 데이터/후지쯔 매출내역(Open~2210)/일별"
#---------------------------------------------------------------------#
#---------------------------------------------------------------------#
# 함수 생성
# year = 숫자, start = 시작월(숫자)
MergedDataSet = function(year=2019,start=1,end=12,pwd){
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
# 2019년 4월에서12월까지만 병합.
sales19 = read_excel(paste0(pwd,Year,"/",file_lst[start]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
newcolnames = colnames(sales19)[-(1:2)] %>% as.numeric %>% sapply(makeyear,month=start,year=year)
colnames(sales19)[3:length(colnames(sales19))] = newcolnames
colnames(sales19)[1] = "SHOP_CD"
for(month in (start+1):end){
# 해당 월 파일 가져오기
sales_month = read_excel(paste0(pwd,Year,"/",file_lst[month]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
# 열이름 변경
newcolnames = colnames(sales_month)[-(1:2)] %>% as.numeric %>% sapply(makeyear,year=year,month=month)
print(newcolnames)
print("*************************")
colnames(sales_month)[3:length(colnames(sales_month))] = newcolnames
colnames(sales_month)[1] = "SHOP_CD"
# 병합
sales19 = merge(sales19,sales_month,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
}
return(sales19)
}
dir = paste0(pwd,"/매출건수")
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,pwd=dir)
salescnt21 = MergedDataSet(year=2021,start=1,pwd=dir)
salescnt22 = MergedDataSet(year=2022,start=1,end=11,pwd=dir)
Year
pwd
list.files(paste0(pwd,Year))
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
file_lst
paste0(pwd,Year)
salescnt22 = MergedDataSet(year=2022,start=1,end=10,pwd=dir)
TotalSalesCnt = full_join(salescnt19,salescnt20,salescnt21,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt = full_join(TotalSalesCnt,salescnt22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSalesCnt)
View(TotalSalesCnt)
dir = paste0(pwd,"/총매출")
# 일별 매출건수
sales19 = MergedDataSet(year=2019,start=4,pwd=dir)
sales20 = MergedDataSet(year=2020,start=1,pwd=dir)
sales22 = MergedDataSet(year=2022,start=1,end=10,pwd=dir)
TotalSales = full_join(sales19,sales20,sales21,by=c("SHOP_CD","SHOP_NAME"))
TotalSales = full_join(TotalSales,sales22,by=c("SHOP_CD","SHOP_NAME"))
dim(TotalSales)
read_excel(file_lst[10]) %>% head(15)
# 상위 디렉토리
pwd = "C:/Users/user/Seungjun/NeoValue/230616_네오밸류 데이터/230616_네오밸류 데이터(발송용)/네오밸류 데이터/02_운영데이터 등/230531_광교 데이터/후지쯔 매출내역(Open~2210)/일별/총매출"
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
# 상위 디렉토리
pwd = "C:/Seungjun/neovalue/NEOVALUE/230616_네오밸류 데이터(발송용)/네오밸류 데이터/02_운영데이터 등/230531_광교 데이터/후지쯔 매출내역(Open~2210)/일별/총매출"
Year=2019
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
file_lst
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
View(slaes10m)
View(sales10m)
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,pwd=dir)
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
head(sales19)
salescnt19 %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
salescnt19 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
TotalSalesCnt = full_join(salescnt19,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
dim(TotalSalesCnt)
dim(salescnt19)
sales10m
dim(sales10m)
sales10m %>% select(SHOP_CD,SHOP_NAME)
head(sales10m)
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_NAME"="명")
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
sales10m %>% select(SHOP_CD,SHOP_NAME)
sales10m[1:5,1:2]
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
sales10m[1:5,1:2]
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
sales10m %>% select(SHOP_CD,SHOP_NAME)
sales10m %>% left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD"))
TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME)
sales10m  %>% select(SHOP_CD,SHOP_NAME) %>% left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD"))
sales10m  %>% select(SHOP_CD) %>% left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD"))
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) %>%
is.na() %>% colSums
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover
recover
recover[is.na(recover$SHOP_NAME)]
recover$SHOP_NAME[is.na(recover$SHOP_NAME)]
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
salescnt19_12 = MergedDataSet(year=2019,start=11,end=12,pwd=dir)
TotalSalesCnt = full_join(salescnt19,salescnt19_1,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt = full_join(salescnt19,salescnt19_12,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
salescnt19_12 = MergedDataSet(year=2019,start=11,end=12,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
salescnt19 %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
TotalSalesCnt = full_join(salescnt19,salescnt19_12,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
dim(TotalSalesCnt)
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
dim(recover)
dim(sales10m)
sales10m
SHOP_LIST = TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME)
SHOP_LIST
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
dim(salescnt19)
salescnt19$SHOP_NAME
salescnt19_12$SHOP_NAME
salescnt20 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
salescnt20
salescnt20$SHOP_NAME
salescnt19_12 = MergedDataSet(year=2019,start=11,end=12,pwd=dir)
View(salescnt19_12)
year=2019
start=11
end=12
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
file_lst
# 2019년 4월에서12월까지만 병합.
sales19 = read_excel(paste0(pwd,Year,"/",file_lst[start]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
View(sales19\)
View(sales19)
start
file_lst[11]
file_lst
#---------------------------------------------------------------------#
#---------------------------------------------------------------------#
# 함수 생성
# year = 숫자, start = 시작월(숫자)
MergedDataSet = function(year=2019,start=1,end=12,pwd){
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
# 2019년 4월에서12월까지만 병합.
sales19 = read_excel(paste0(pwd,Year,"/",file_lst[start]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
newcolnames = colnames(sales19)[-(1:2)] %>% as.numeric %>% sapply(makeyear,month=start,year=year)
colnames(sales19)[3:length(colnames(sales19))] = newcolnames
colnames(sales19)[1] = "SHOP_CD"
for(month in (start+1):end){
# 해당 월 파일 가져오기
sales_month = read_excel(paste0(pwd,Year,"/",file_lst[month]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3")
# 열이름 변경
newcolnames = colnames(sales_month)[-(1:2)] %>% as.numeric %>% sapply(makeyear,year=year,month=month)
print(newcolnames)
print("*************************")
colnames(sales_month)[3:length(colnames(sales_month))] = newcolnames
colnames(sales_month)[1] = "SHOP_CD"
# 병합
sales19 = merge(sales19,sales_month,by=c("SHOP_CD","SHOP_NAME"),all=TRUE)
}
return(sales19)
}
Year=2019
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
file_lst
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
makeyear = function(year,month,day){
days = (year-2000)*10000+month*100+day
return(days)
}
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
salescnt19_12 = MergedDataSet(year=2019,start=11,end=12,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
salescnt19 %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
TotalSalesCnt = full_join(salescnt19,salescnt19_12,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
sales10m %>% select(SHOP_CD,SHOP_NAME)
SHOP_LIST = TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME)
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
dim(recover)
recover$SHOP_CD[is.na(recover$SHOP_NAME)] ="키오스크(더부쓰 비어위크)"
View(recover)
write.csv(recover)
write.csv(recover,"201910_recover.csv")
getwd()
# save
library(openxlsx)
Membership = createWorkbook("2019recover")
addWorksheet(Membership,"2019")
writeDataTable(Membership,"2019recover",recover)
writeDataTable(Membership,"2019",recover)
saveWorkbook(Membership,file ="2019recover.xlsx")
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
View(sales10m)
recover$SHOP_CD[is.na(recover$SHOP_NAME)] = "키오스크(더부쓰 비어위크)"
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
# 일별 매출건수
salescnt19 = MergedDataSet(year=2019,start=4,end=9,pwd=dir)
salescnt19_12 = MergedDataSet(year=2019,start=11,end=12,pwd=dir)
salescnt20 = MergedDataSet(year=2020,start=1,end=12,pwd=dir)
salescnt19 %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
TotalSalesCnt = full_join(salescnt19,salescnt19_12,salescnt20,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
sales10m %>% select(SHOP_CD,SHOP_NAME)
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[10]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
sales10m %>% select(SHOP_CD,SHOP_NAME)
SHOP_LIST = TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME)
sales10m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover
recover$SHOP_NAME[is.na(recover$SHOP_NAME)] = "키오스크(더부쓰 비어위크)"
# save
library(openxlsx)
Membership = createWorkbook("2019recover")
addWorksheet(Membership,"2019")
writeDataTable(Membership,"2019",recover)
saveWorkbook(Membership,file ="2019recover.xlsx")
year=2019
Year = paste0("/",year,"년")
Year
year=2019
year=2022
Year = paste0("/",year,"년")
file_lst = list.files(paste0(pwd,Year))
file_lst
sales10m = read_excel(paste0(pwd,Year,"/",file_lst[1]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
colnames(sales10m)
sales1m = read_excel(paste0(pwd,Year,"/",file_lst[1]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
sales1m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover2
dim(sales1m)
dim(recover2)
recover$SHOP_CD[is.na(recover$SHOP_NAME)]
recover$SHOP_CD[is.na(recover2$SHOP_NAME)]
salescnt21 = MergedDataSet(year=2021,start=1,end=12,pwd=dir)
salescnt22 = MergedDataSet(year=2022,start=2,end=10,pwd=dir)
TotalSalesCnt = full_join(salescnt21,salescnt22,by=c("SHOP_CD","SHOP_NAME"))
TotalSalesCnt %>% select(SHOP_CD,SHOP_NAME) %>% head(5)
sales1m = read_excel(paste0(pwd,Year,"/",file_lst[1]),skip=11) %>%
slice(-1,-n()) %>%
select(-"합계",-1) %>%
rename("SHOP_NAME"="...3","SHOP_CD"="매장코드")
sales1m  %>%
select(SHOP_CD) %>%
left_join(TotalSalesCnt%>% select(SHOP_CD,SHOP_NAME),by=c("SHOP_CD")) -> recover2
recover$SHOP_CD[is.na(recover2$SHOP_NAME)]
recover2$SHOP_CD[is.na(recover2$SHOP_NAME)]
dim(sales1m)
dim(recover)
dim(recover2)
dim(sales1m)
dim(recover2)
recover2 %>% is.na() %>% colSums()
# save
library(openxlsx)
Membership = createWorkbook("2019recover")
Membership = createWorkbook("2022recover")
addWorksheet(Membership,"2022")
writeDataTable(Membership,"2022",recover2)
saveWorkbook(Membership,file ="2022recover.xlsx")
